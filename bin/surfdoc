#!/bin/sh

set -e

findcmd=${SURFDOC_COMMAND:-"find -L /usr/local/go/doc /usr/share/doc -type f -o -type l 2>/dev/null"}
cache=~/.cache/surfdoc.txt

if [ -f "$cache" ]; then
	file=$(dmenu -i -l 24 -p "doc:" < "$cache")
else
	file=$(eval "$findcmd" | tee "$cache" | dmenu -i -l 24 -p "doc:")
fi

if [ -z "$file" ]; then
	exit 1
fi

case $file in
*.gz) gzip -d < "$file" > /tmp/surfdoc-"$USER".txt && file=/tmp/surfdoc-"$USER".txt ;;
esac

exec surf "$file"

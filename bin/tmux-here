#!/bin/sh

set -e

cmd=$SHELL

if [ -n "$1" ]; then
	if [ -d "$1" ]; then
		cd "$1"
	elif [ -e "$1" ]; then
		cd "$(dirname "$1")"
		cmd="vim \"$(basename "$1")\" ; \"$SHELL\""
	else
		mkdir -p "$1"
		cd "$1"
	fi
fi
dirname=$(basename "$PWD")
sessionname=$(printf '%.*s' 7 "$(echo "$dirname" | tr -cd '[:alnum:]')")

if [ -t 0 ]; then
	exec tmux new-session -As "$sessionname" "$cmd"
else
	exec st tmux new-session -As "$sessionname" "$cmd"
fi
